use warehouse COMPUTE_WH;
use database SNOWFLAKE_SAMPLE_DATA ;
use schema TPCH_SF1;

with customers as (
select c_custkey, c_name,c_address, c_phone, c_nationkey 

from SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.CUSTOMER
),
orders as (
select * from SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.ORDERS o
),

cutomers_order as (
select c.c_custkey as id, min(o.o_orderdate) premiere_date_commande, max(o.o_orderdate) dernierecommande, count(distinct o_orderkey), sum(o_totalprice) totalprice

from SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.CUSTOMER c join SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.ORDERS o on c.c_custkey=o.o_custkey
group by c.c_custkey
),
final as (
select c.*, premiere_date_commande,date_dernierecommande, sum(totalprice) totalprice

from customers c 
left outer join cutomers_order o on c_custkey=c.c_custkey
)

select * from final